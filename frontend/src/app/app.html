<div class="container">
  <!-- Header -->
  <header class="header">
    <h1>{{ title }}</h1>
    <p class="subtitle">Calculate values from the LabSeq sequence</p>
    <div class="api-status" [class.connected]="apiStatus.includes('‚úì')" [class.disconnected]="apiStatus.includes('‚úó')">
      API Status: {{ apiStatus }}
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Calculator Card -->
    <div class="card calculator-card">
      <h2>Calculate LabSeq Value</h2>
      
      <div class="info-box">
        <strong>Sequence Definition:</strong>
        <ul>
          <li>l(0) = 0</li>
          <li>l(1) = 1</li>
          <li>l(2) = 0</li>
          <li>l(3) = 1</li>
          <li>l(n) = l(n-4) + l(n-3) for n > 3</li>
        </ul>
      </div>

      <form (ngSubmit)="calculate()" class="calculator-form">
        <div class="form-group">
          <label for="indexInput">Enter Index (n):</label>
          <input
            type="number"
            id="indexInput"
            [(ngModel)]="inputValue"
            name="indexInput"
            placeholder="e.g., 10, 100, 1000, 5000..."
            min="0"
            step="1"
            class="form-control"
            [disabled]="loading"
          />
    
        </div>

        <div class="button-group">
          <button type="submit" class="btn btn-primary" [disabled]="loading || inputValue === null">
            @if (!loading) {
               <span>Calculate</span>
            }
            @if (loading) {
              <span class="spinner"></span> Calculating...
            }
          </button>
          <button type="button" class="btn btn-secondary" (click)="reset()" [disabled]="loading">
            Reset
          </button>
        </div>
      </form>

      <!-- Error Message -->
       @if (error) {
        <div class="alert alert-error">
          <strong>‚ö†Ô∏è Error:</strong> {{ error }}
        </div>
      }
  
      <!-- Result -->
    @if (result) {
      <div class="result-container">
        <h3>üìä Result</h3>
        <div class="result-card">
          <div class="result-row">
            <span class="result-label">Index (n):</span>
            <span class="result-value">{{ result.n }}</span>
          </div>
          
          <!-- Componente de exibi√ß√£o do n√∫mero grande -->
          <div class="result-row full-width">
            <span class="result-label">Value:</span>
            <app-number-display 
              [value]="result.value" 
              [digits]="result.digits">
            </app-number-display>
          </div>
          
          <div class="result-row">
            <span class="result-label">Calculation Time:</span>
            <span class="result-value">{{ result.calculationTime }} ms</span>
          </div>
          <div class="result-row">
            <span class="result-label">Source:</span>
            <span class="result-value" [class.cached]="result.fromCache">
              {{ result.fromCache ? 'üì¶ From Cache' : 'üîÑ Fresh Calculation' }}
            </span>
          </div>
        </div>
      </div>
    }
   
    </div>

    <!-- History Card -->
      @if (history.length > 0) {
      <div class="card history-card">
        <div class="history-header">
          <h2>üìú Calculation History</h2>
          <button class="btn btn-clear" (click)="clearHistory()">Clear History</button>
        </div>
        
      
      <div class="history-list">
        @for (item of history; track item.n) {
          <div class="history-item" (click)="loadFromHistory(item.n)">
            <div class="history-main">
              <span class="history-index">n = {{ item.n }}</span>
              <span class="history-value" [title]="item.value">
                {{ item.digits <= 30 ? item.value : (item.value | slice:0:30) + '...' }}
              </span>
              <span class="history-digits">{{ item.digits }} digits</span>
            </div>
            <div class="history-meta">
              <span class="history-time">‚è±Ô∏è {{ item.calculationTime }}ms</span>
              @if (item.fromCache) {
                <span class="history-cache">üì¶ Cached</span>
              }
              <span class="history-timestamp">{{ item.timestamp | date:'short' }}</span>
            </div>
          </div>
        }
      </div>
    </div>
  }
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p>Yanis Marina Faquir</p>
    <a href="http://localhost:8080/swagger-ui/" target="_blank" class="swagger-link">
      üìñ View API Documentation
    </a>
  </footer>
</div>